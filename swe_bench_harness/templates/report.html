<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ experiment_name }} - Benchmark Report</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #0f3460;
            --text-primary: #eaeaea;
            --text-secondary: #a0a0a0;
            --accent: #e94560;
            --success: #4ade80;
            --warning: #fbbf24;
            --border: #2a2a4a;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .card-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .card-value {
            font-size: 1.75rem;
            font-weight: 600;
        }

        .card-value.success {
            color: var(--success);
        }

        .card-value.accent {
            color: var(--accent);
        }

        .section {
            margin-bottom: 2rem;
        }

        h2 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: 8px;
            overflow: hidden;
        }

        th, td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--bg-card);
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
        }

        td {
            font-size: 0.95rem;
        }

        tr:hover {
            background: rgba(233, 69, 96, 0.05);
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
        }

        .chart-container {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid var(--border);
        }

        .chart-container h3 {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        canvas {
            max-height: 300px;
        }

        .footer {
            margin-top: 3rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .success-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .success-high {
            background: rgba(74, 222, 128, 0.2);
            color: var(--success);
        }

        .success-medium {
            background: rgba(251, 191, 36, 0.2);
            color: var(--warning);
        }

        .success-low {
            background: rgba(233, 69, 96, 0.2);
            color: var(--accent);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>{{ experiment_name }}</h1>
            <p class="meta">Generated: {{ timestamp }} | Duration: {{ total_duration }}</p>
        </header>

        <div class="summary-cards">
            <div class="card">
                <div class="card-label">Total Runs</div>
                <div class="card-value">{{ total_runs }}</div>
            </div>
            <div class="card">
                <div class="card-label">Successful Runs</div>
                <div class="card-value success">{{ successful_runs }}</div>
            </div>
            <div class="card">
                <div class="card-label">Success Rate</div>
                <div class="card-value">{{ "%.1f"|format(successful_runs / total_runs * 100 if total_runs > 0 else 0) }}%</div>
            </div>
            <div class="card">
                <div class="card-label">Total Cost</div>
                <div class="card-value accent">${{ "%.2f"|format(total_cost) }}</div>
            </div>
        </div>

        <section class="section">
            <h2>Configuration Comparison</h2>
            <table>
                <thead>
                    <tr>
                        <th>Configuration</th>
                        <th>Success Rate</th>
                        <th>Avg Duration</th>
                        <th>Avg Tokens</th>
                        <th>Avg Tool Calls</th>
                        <th>Avg Cost</th>
                        <th>Total Cost</th>
                    </tr>
                </thead>
                <tbody>
                    {% for summary in summaries %}
                    <tr>
                        <td>
                            <strong>{{ summary.config_name }}</strong>
                            <br><small style="color: var(--text-secondary)">{{ summary.config_id }}</small>
                        </td>
                        <td>
                            <span class="success-badge {% if summary.success_rate >= 0.7 %}success-high{% elif summary.success_rate >= 0.4 %}success-medium{% else %}success-low{% endif %}">
                                {{ "%.1f"|format(summary.success_rate * 100) }}%
                            </span>
                            <br><small style="color: var(--text-secondary)">{{ summary.success_count }}/{{ summary.total_runs }}</small>
                        </td>
                        <td>{{ "%.1f"|format(summary.duration_mean) }}s</td>
                        <td>{{ "{:,}".format(summary.tokens_mean) }}</td>
                        <td>{{ "%.1f"|format(summary.tool_calls_mean) }}</td>
                        <td>${{ "%.4f"|format(summary.cost_mean) }}</td>
                        <td>${{ "%.2f"|format(summary.cost_total) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2>Visualizations</h2>
            <div class="chart-grid">
                <div class="chart-container">
                    <h3>Success Rate by Configuration</h3>
                    <canvas id="successChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Average Duration (seconds)</h3>
                    <canvas id="durationChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Average Token Usage</h3>
                    <canvas id="tokenChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>Cost per Run ($)</h3>
                    <canvas id="costChart"></canvas>
                </div>
            </div>
        </section>

        <footer class="footer">
            <p>SWE-Bench Plugin Efficiency Benchmark Tool</p>
        </footer>
    </div>

    <script>
        const chartData = {{ chart_data | tojson }};

        const chartColors = {
            primary: '#e94560',
            secondary: '#4ade80',
            tertiary: '#60a5fa',
            quaternary: '#fbbf24',
            background: 'rgba(233, 69, 96, 0.2)',
        };

        const commonOptions = {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(255, 255, 255, 0.1)'
                    },
                    ticks: {
                        color: '#a0a0a0'
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#a0a0a0'
                    }
                }
            }
        };

        // Success Rate Chart
        new Chart(document.getElementById('successChart'), {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    data: chartData.success_rates,
                    backgroundColor: chartData.success_rates.map(rate =>
                        rate >= 70 ? '#4ade80' : rate >= 40 ? '#fbbf24' : '#e94560'
                    ),
                    borderRadius: 4
                }]
            },
            options: {
                ...commonOptions,
                scales: {
                    ...commonOptions.scales,
                    y: {
                        ...commonOptions.scales.y,
                        max: 100,
                        ticks: {
                            ...commonOptions.scales.y.ticks,
                            callback: value => value + '%'
                        }
                    }
                }
            }
        });

        // Duration Chart
        new Chart(document.getElementById('durationChart'), {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    data: chartData.durations,
                    backgroundColor: chartColors.tertiary,
                    borderRadius: 4
                }]
            },
            options: commonOptions
        });

        // Token Chart
        new Chart(document.getElementById('tokenChart'), {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    data: chartData.tokens,
                    backgroundColor: chartColors.quaternary,
                    borderRadius: 4
                }]
            },
            options: {
                ...commonOptions,
                scales: {
                    ...commonOptions.scales,
                    y: {
                        ...commonOptions.scales.y,
                        ticks: {
                            ...commonOptions.scales.y.ticks,
                            callback: value => value.toLocaleString()
                        }
                    }
                }
            }
        });

        // Cost Chart
        new Chart(document.getElementById('costChart'), {
            type: 'bar',
            data: {
                labels: chartData.labels,
                datasets: [{
                    data: chartData.costs,
                    backgroundColor: chartColors.primary,
                    borderRadius: 4
                }]
            },
            options: {
                ...commonOptions,
                scales: {
                    ...commonOptions.scales,
                    y: {
                        ...commonOptions.scales.y,
                        ticks: {
                            ...commonOptions.scales.y.ticks,
                            callback: value => '$' + value.toFixed(4)
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
